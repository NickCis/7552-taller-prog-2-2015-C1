language: cpp

compiler:
    - gcc
    - clang

before_install:
   # As of this writing (10 May 2014) the Travis build environment is Ubuntu 12.04,
   # which needs the following ugly dependency incantations to build RocksDB:
    - if [ $CC == gcc ]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
    - if [ $CC == gcc ]; then sudo apt-get update -qq
    - if [ $CC == gcc ]; then sudo apt-get install -y -qq gcc-4.9 g++-4.9 zlib1g-dev libbz2-dev libsnappy-dev
    - if [ $CC == gcc ]; then sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 50
    - if [ $CC == gcc ]; then sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 50
    - wget https://gflags.googlecode.com/files/libgflags0_2.0-1_amd64.deb
    - sudo dpkg -i libgflags0_2.0-1_amd64.deb
    - wget https://gflags.googlecode.com/files/libgflags-dev_2.0-1_amd64.deb
    - sudo dpkg -i libgflags-dev_2.0-1_amd64.deb
    - wget "https://github.com/facebook/rocksdb/archive/rocksdb-3.9.1.zip" && unzip rocksdb-3.9.1

install:
    - cd rocksdb-rocksdb-3.9.1
    - make shared_lib && sudo install -d /usr/include && sudo cp -r include/rocksdb /usr/include && sudo install -m755 -D librocksdb.so /usr/lib/librocksdb.so
    - cd -

before_script:
    - mkdir -p server/build
    - cd server/build

script: cmake ../ && make
